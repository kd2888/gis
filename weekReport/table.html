<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/data.js"></script>
    <style>
        .table>tbody>tr>td{
            vertical-align: middle
        }
        .table>tbody>tr>th{
            vertical-align: middle
        }
        .table>tbody>tr td a{
           margin-right: 10px;
        }
        .table>tbody>tr.important{
            background: #f2dede;
        }
        .table>tbody>tr .table-name {
            background: #fff;
        }

    </style>
</head>
<body>
<div class="container-fluid" style="padding-top: 30px">
    <div class="row-fluid">
        <div class="span12">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="table.html">索引信息</a>
                </li>
                <li>
                    <a href="all.html">全局展示</a>
                </li>
            </ul>
            <div class="page-header">
                <h1>
                    <small><strong>索引信息展示</strong></small>
                </h1>
            </div>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th width="20">
                        工作名称
                    </th>
                    <th width="30">
                        内容描述
                    </th>
                    <th width="30">
                        分项描述
                    </th>
                    <th width="20">
                        操作
                    </th>
                </tr>
                </thead>
                <tbody>
                <!--<tr>-->
                    <!--<td rowspan="5">业务管理</td>-->
                    <!--<td rowspan="2">环卫业务战略及责权利体系</td>-->
                    <!--<td>业务战略体系</td>-->
                    <!--<td><a href="" class="action">删除</a>-->
                        <!--<a href="" class="action">选为重点</a>-->
                        <!--<a href="edit.html" class="action">编辑</a>-->
                    <!--</td>-->
                <!--</tr>-->
                <!--<tr>-->
                    <!--<td>工作管理方式</td>-->
                    <!--<td><a href="" class="action">删除</a>-->
                        <!--<a href="" class="action">选为重点</a>-->
                        <!--<a href="edit.html" class="action">编辑</a>-->
                    <!--</td>-->
                <!--</tr>-->
                <!--<tr>-->
                    <!--<td rowspan="3">过程管控</td>-->
                    <!--<td>人员招收计划</td>-->
                    <!--<td><a href="" class="action">删除</a>-->
                        <!--<a href="" class="action">选为重点</a>-->
                        <!--<a href="edit.html" class="action">编辑</a>-->
                    <!--</td>-->
                <!--</tr>-->
                <!--<tr>-->
                    <!--<td>建立资料积累、调研表单、项目执行的工作方法</td>-->
                    <!--<td><a href="" class="action">删除</a>-->
                        <!--<a href="" class="action">选为重点</a>-->
                        <!--<a href="" class="action">编辑</a>-->
                    <!--</td>-->
                <!--</tr>-->
                <!--<tr>-->
                    <!--<td>分享机制、版本管理</td>-->
                    <!--<td><a href="" class="action">删除</a>-->
                        <!--<a href="" class="action">选为重点</a>-->
                        <!--<a href="" class="action">编辑</a>-->
                    <!--</td>-->
                <!--</tr>-->
                </tbody>
            </table>

    </div>
</div>
</div>
<script>
    $(function () {
        var html=''
        var impor=[];
        console.log(data)
        for(var i=0;i<data.length;i++){
               var content =data[i].content;
               var count=0;
               console.log(content)
             for(var j=0;j<content.length;j++){
                    var item=content[j].item
                    console.log(item)
                    count+=item.length;
                 if(j==0){
                     html+='<td  rowspan="'+item.length+'" class="table-name">'+content[j].contentName+'</td>'
                 }else{
                     html+='<tr ><td  rowspan="'+item.length+'" class="table-name">'+content[j].contentName+'</td>'
                 }
                   for(var k=0;k<item.length;k++){

                       if(k==0){
                           html+='<td>'+item[k].name+'</td>'
                       }else{
                           html+='<tr><td>'+item[k].name+'</td>'
                       }
                       if(item[k].isImportant){
                           impor.push(k+(count-item.length))
                           html+='<td data-id="'+item[k].itemId+'"><a href="javascript:void(0);" class="action point-action">取消重点</a> <a href="javascript:void(0);" class="action edit-action">编辑</a></td></tr>'
                       }else{
                           html+='<td data-id="'+item[k].itemId+'"><a href="javascript:void(0);" class="action point-action">选为重点</a> <a href="javascript:void(0);" class="action edit-action">编辑</a></td></tr>'
                       }

                   }

             }
             html='<tr ><td rowspan="'+count+'" class="table-name">'+data[i].name+'</td>'+html;
        }
        $(".table tbody").html(html)
        for(var i=0;i<impor.length;i++){
            $(".table tbody tr").eq(impor[i]).addClass("important")
        }
        initAction()

    })
    function initAction() {
        $(".point-action").unbind("click").bind("click",function () {
            if($(this).parents("tr").hasClass("important")){
                $(this).parents("tr").removeClass("important")
                $(this).html("选为重点")

            }else{
                $(this).parents("tr").addClass("important")
                $(this).html("取消重点")
            }
        })
        $(".edit-action").unbind("click").bind("click",function () {
           var id=$(this).parent().attr("data-id")
            window.location.href="edit.html?id="+id
        })
    }

</script>
</body>
</html>